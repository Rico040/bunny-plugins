(function(f,x,p,a,O,U,c,h,X,G,Z,W,C,v){"use strict";function F(e,i,t,n,l,s,u){try{var o=e[s](u),g=o.value}catch(B){t(B);return}o.done?i(g):Promise.resolve(g).then(n,l)}function R(e){return function(){var i=this,t=arguments;return new Promise(function(n,l){var s=e.apply(i,t);function u(g){F(s,n,l,u,o,"next",g)}function o(g){F(s,n,l,u,o,"throw",g)}u(void 0)})}}var Q="https://deeplx.mingming.dev/translate",ee=function(){var e=R(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s=yield(yield fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:i,source_lang:t,target_lang:n})})).json();if(s.code!==200)throw Error(`Failed to translate text from DeepL: ${s.message}`);return{source_lang:t,text:s.data}}catch(u){throw Error(`Failed to fetch from DeepL: ${u}`)}});return function(i){return e.apply(this,arguments)}}(),$={translate:ee},ae=function(){var e=R(function*(i,t="auto",n,l=!1){try{if(l)return{source_lang:t,text:i};var s="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:t,tl:n,dt:"t",dj:"1",source:"input",q:i}),u=yield(yield fetch(s)).json();return{source_lang:t,text:u.sentences.map(o=>o.trans).join("")}}catch(o){throw Error(`Failed to fetch from Google Translate: ${o}`)}});return function(i){return e.apply(this,arguments)}}(),j={translate:ae},H=p.findByProps("openLazy","hideActionSheet"),z=p.findByProps("ActionSheetRow")?.ActionSheetRow??h.Forms.FormRow,te=p.findByStoreName("MessageStore"),ne=p.findByStoreName("ChannelStore"),re=`
`,ie=a.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:U.semanticColors.INTERACTIVE_NORMAL}}),S=[],se=()=>O.before("openLazy",H,([e,i,t])=>{var n=t?.message;i!=="MessageLongPressActionSheet"||!n||e.then(l=>{var s=O.after("default",l,(u,o)=>{a.React.useEffect(()=>()=>{s()},[]);var g=X.findInReactTree(o,m=>m?.[0]?.type?.name==="ActionSheetRow");if(g){var B=Math.max(g.findIndex(m=>m.props.message===a.i18n.Messages.MARK_UNREAD),0),T=te.getMessage(n.channel_id,n.id);if(!(!T?.content&&!n.content)){var b=T?.id??n.id,D=T?.content??n.content,E=S.find(m=>Object.keys(m)[0]===b,"cache object"),P=E?"Revert":"Translate",J=P==="Translate"?c.getAssetIDByName("LanguageIcon"):c.getAssetIDByName("ic_highlight"),Ae=function(){var m=R(function*(){H.hideActionSheet();try{var L=r.target_lang,w=P==="Translate",Ne=r.immersive_enabled;if(!T)return;var be=/<(a?):\w+:\d+>|<@!?\d+>|<#\d+>/g,k=[],I=D.replace(be,y=>(k.push(y),` [[${k.length-1}]] `)),M;switch(r.translator){case 0:console.log("Translating with DeepL: ",I),M=yield $.translate(I,void 0,L,!w);break;case 1:console.log("Translating with GTranslate: ",I),M=yield j.translate(I,void 0,L,!w);break}var _=M.text;k.forEach((y,we)=>{var Ie=new RegExp(`\\[\\[\\s*${we}\\s*\\]\\]`,"g");_=_.replace(Ie,y)});var Le=w?Ne?`${D}${re}${_.trim()} \`[${L?.toLowerCase()}]\``:`${_.trim()} \`[${L?.toLowerCase()}]\``:E[b];a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{id:b,channel_id:T.channel_id,guild_id:ne.getChannel(T.channel_id)?.guild_id,content:Le},log_edit:!1,otherPluginBypass:!0}),w?S.unshift({[b]:D}):S=S.filter(y=>y!==E,"cached data override")}catch(y){v.showToast("Failed to translate message. Please check Debug Logs for more info.",c.getAssetIDByName("Small")),G.logger.error(y)}});return function(){return m.apply(this,arguments)}}();g.splice(B,0,a.React.createElement(z,{label:`${P} Message`,icon:a.React.createElement(z.Icon,{source:J,IconComponent:()=>a.React.createElement(a.ReactNative.Image,{resizeMode:"cover",style:ie.iconComponent,source:J})}),onPress:Ae}))}}})})}),le=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),K=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),oe=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),V={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},ce={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},ue=p.findByProps("sendBotMessage"),ge=Object.entries(V).map(([e,i])=>({name:e,displayName:e,value:i})),he=()=>Z.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:oe.CHAT,inputType:le.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:K.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:K.STRING,choices:[...ge],required:!0}],execute(e,i){return R(function*(){var[t,n]=e;try{var l;switch(r.translator){case 0:l=yield $.translate(t.value,void 0,n.value);break;case 1:l=yield j.translate(t.value,void 0,n.value);break}return yield new Promise(s=>W.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(h.Codeblock,null,l.text),confirmText:"Yep, send it!",onConfirm:()=>s({content:l.text}),cancelText:"Nope, don't send it"}))}catch(s){return G.logger.error(s),ue.sendBotMessage(i.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}})()}}),{FormRow:A}=h.Forms,{ScrollView:q}=a.ReactNative,de=()=>{C.useProxy(r);var[e,i]=a.React.useState("");return r.translator==0?a.React.createElement(q,{style:{flex:1}},a.React.createElement(h.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(V).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(A,{label:t,trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,v.showToast(`Saved ToLang to ${t}`,c.getAssetIDByName("check")))}}))):a.React.createElement(q,{style:{flex:1}},a.React.createElement(h.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:t=>{i(t)}}),Object.entries(ce).filter(([t,n])=>t.toLowerCase().includes(e.toLowerCase())).map(([t,n])=>a.React.createElement(A,{label:t,trailing:()=>a.React.createElement(A.Arrow,null),onPress:()=>{r.target_lang!=n&&(r.target_lang=n,v.showToast(`Saved ToLang to ${t}`,c.getAssetIDByName("check")))}})))},{FormRow:N}=h.Forms,{ScrollView:me}=a.ReactNative,ye=()=>(C.useProxy(r),a.React.createElement(me,{style:{flex:1}},a.React.createElement(N,{label:"DeepL",trailing:()=>a.React.createElement(N.Arrow,null),onPress:()=>{r.translator!=0&&(r.translator=0,v.showToast("Saved Translator to DeepL",c.getAssetIDByName("check")))}}),a.React.createElement(N,{label:"Google Translate",trailing:()=>a.React.createElement(N.Arrow,null),onPress:()=>{r.translator!=1&&(r.translator=1,v.showToast("Saved Translator to Google Translate",c.getAssetIDByName("check")))}}))),{ScrollView:Te,Text:pe}=a.ReactNative,{FormRow:d,FormSwitchRow:ve}=h.Forms,fe=a.stylesheet.createThemedStyleSheet({subheaderText:{color:U.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:a.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),Re=()=>{var e=a.NavigationNative.useNavigation();return C.useProxy(r),a.React.createElement(Te,null,a.React.createElement(ve,{label:"Immersive Translation",subLabel:"Display both original and translation",leading:a.React.createElement(d.Icon,{source:c.getAssetIDByName("ic_chat_bubble_filled_24px")}),value:r.immersive_enabled??!0,onValueChange:i=>{r.immersive_enabled=i}}),a.React.createElement(d,{label:"Translate to",subLabel:r.target_lang?.toLowerCase(),leading:a.React.createElement(d.Icon,{source:c.getAssetIDByName("ic_activity_24px")}),trailing:()=>a.React.createElement(d.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translate to",render:de})}),a.React.createElement(d,{label:"Translator",subLabel:r.translator?"Google Translate":"DeepL",leading:a.React.createElement(d.Icon,{source:c.getAssetIDByName("ic_locale_24px")}),trailing:()=>a.React.createElement(d.Arrow,null),onPress:()=>e.push("VendettaCustomPage",{title:"Translator",render:ye})}),a.React.createElement(pe,{style:fe.subheaderText,onPress:()=>a.url.openURL("https://github.com/Rico040/bunny-plugins")},`Build: (${x.manifest.hash.substring(0,7)})`))},r=x.storage;r.target_lang??="en",r.translator??=1,r.immersive_enabled??=!0;var Y=[],Se={onLoad:()=>Y=[se(),he()],onUnload:()=>{for(var e of Y)e()},settings:Re};return f.default=Se,f.settings=r,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
